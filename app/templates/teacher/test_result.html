{% extends "base.html" %}

{% block title %}Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - {{ result.test.title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
            <div class="card mb-4">
                <div class="card-header text-white 
                    {% if result.score >= 80 %}bg-success
                    {% elif result.score >= 50 %}bg-warning
                    {% else %}bg-danger{% endif %}">
                    <h4 class="mb-0">
                        ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </h4>
                </div>
                <div class="card-body text-center">
                    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                    <div class="display-1 fw-bold 
                        {% if result.score >= 80 %}text-success
                        {% elif result.score >= 50 %}text-warning
                        {% else %}text-danger{% endif %}">
                        {{ "%.1f"|format(result.score) }}%
                    </div>
                    
                    <!-- Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
                    <h5 class="mb-4">
                        {% if result.score >= 80 %}ğŸ‰ Ù…Ù…ØªØ§Ø² - Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!
                        {% elif result.score >= 70 %}ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ - Ø£Ø­Ø³Ù†Øª!
                        {% elif result.score >= 50 %}ğŸ‘Œ Ù…Ù‚Ø¨ÙˆÙ„ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³Ù†
                        {% else %}ğŸ’ª ØªØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø¯{% endif %}
                    </h5>
                    
                    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-primary">{{ result.correct_answers }}/{{ result.total_questions }}</h3>
                                <p class="text-muted mb-0">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-info">{{ (result.time_taken // 60)|int }}:{{ '%02d' % (result.time_taken % 60) }}</h3>
                                <p class="text-muted mb-0">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-3">
                                <h3 class="text-success">{{ result.test.subject }}</h3>
                                <p class="text-muted mb-0">Ø§Ù„Ù…Ø§Ø¯Ø©</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h5>
                </div>
                <div class="card-body">
                    {% set questions = result.test.get_questions() %}
                    {% set user_answers = result.get_answers() %}
                    
                    {% for question in questions %}
                    <div class="answer-item mb-4 p-3 border rounded">
                        <h6>
                            <span class="badge bg-primary me-2">Ø³ {{ loop.index }}</span>
                            {{ question.question }}
                            <span class="badge bg-secondary float-end">{{ question.points }} Ù†Ù‚Ø·Ø©</span>
                        </h6>
                        
                        <!-- Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
                        <div class="mb-2">
                            <small class="text-muted">
                                {% if question.type == 'multiple_choice' %}ğŸ§© Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
                                {% elif question.type == 'true_false' %}âœ… ØµØ­/Ø®Ø·Ø£
                                {% elif question.type == 'fill_blank' %}ğŸ“ Ù…Ù„Ø¡ ÙØ±Ø§Øº
                                {% elif question.type == 'matching' %}ğŸ”— ØªÙˆØµÙŠÙ„
                                {% endif %}
                            </small>
                        </div>
                        
                        <!-- Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© -->
                        <div class="answer-result">
                            {% set user_answer = user_answers.get(question.id|string) %}
                            {% set is_correct = false %}
                            
                            <!-- ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© -->
                            {% if question.type == 'multiple_choice' %}
                                {% set is_correct = user_answer and user_answer|int == question.correct_answer %}
                            {% elif question.type == 'true_false' %}
                                {% set is_correct = user_answer and user_answer.lower() == question.correct_answer|string|lower %}
                            {% elif question.type == 'fill_blank' %}
                                {% set is_correct = user_answer and user_answer.strip().lower() == question.correct_answer.strip().lower() %}
                            {% endif %}
                            
                            <div class="alert {% if is_correct %}alert-success{% else %}alert-danger{% endif %}">
                                <strong>{% if is_correct %}âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©{% else %}âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©{% endif %}</strong>
                                
                                {% if question.explanation %}
                                <div class="mt-2">
                                    <strong>ğŸ’¡ Ø´Ø±Ø­:</strong> {{ question.explanation }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
            <div class="text-center mt-4">
                <a href="{{ url_for('main.diagnostic') }}" class="btn btn-primary me-2">
                    <i class="fas fa-tasks"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                </a>
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}