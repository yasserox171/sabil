{% extends "teacher/base.html" %}

{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - {{ test.title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="text-primary">â“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h1>
                    <p class="text-muted">{{ test.title }} - {{ questions|length }} Ø³Ø¤Ø§Ù„</p>
                </div>
                <div>
                    <a href="{{ url_for('teacher.teacher_tests_management') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ -->
        <div class="col-lg-5 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" id="questionForm">
                        {{ form.hidden_tag() }}
                        
                        <!-- Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
                        <div class="mb-3">
                            {{ form.question_type.label(class="form-label") }}
                            {{ form.question_type(class="form-select", id="questionType") }}
                        </div>

                        <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ù†Ù‚Ø§Ø· -->
                        <div class="mb-3">
                            {{ form.question.label(class="form-label") }}
                            {{ form.question(class="form-control", rows="3", placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§...") }}
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.points.label(class="form-label") }}
                                {{ form.points(class="form-control", type="number", min="1") }}
                            </div>
                        </div>

                        <!-- Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª -->
                        <div id="multipleChoiceFields" class="question-fields">
                            <h6 class="text-primary mb-3">ğŸ§© Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</h6>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    {{ form.option1.label(class="form-label") }}
                                    {{ form.option1(class="form-control", placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„") }}
                                </div>
                                <div class="col-md-6 mb-2">
                                    {{ form.option2.label(class="form-label") }}
                                    {{ form.option2(class="form-control", placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ") }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    {{ form.option3.label(class="form-label") }}
                                    {{ form.option3(class="form-control", placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«") }}
                                </div>
                                <div class="col-md-6 mb-2">
                                    {{ form.option4.label(class="form-label") }}
                                    {{ form.option4(class="form-control", placeholder="Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹") }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form.correct_choice.label(class="form-label") }}
                                {{ form.correct_choice(class="form-select") }}
                            </div>
                        </div>

                        <!-- ØµØ­/Ø®Ø·Ø£ -->
                        <div id="trueFalseFields" class="question-fields" style="display: none;">
                            <h6 class="text-primary mb-3">âœ… ØµØ­/Ø®Ø·Ø£</h6>
                            <div class="mb-3">
                                {{ form.correct_bool.label(class="form-label") }}
                                {{ form.correct_bool(class="form-select") }}
                            </div>
                        </div>

                        <!-- Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº -->
                        <div id="fillBlankFields" class="question-fields" style="display: none;">
                            <h6 class="text-primary mb-3">ğŸ“ Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº</h6>
                            <div class="mb-3">
                                {{ form.correct_text.label(class="form-label") }}
                                {{ form.correct_text(class="form-control", placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©") }}
                            </div>
                            <div class="mb-3">
                                {{ form.hint_text.label(class="form-label") }}
                                {{ form.hint_text(class="form-control", placeholder="ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)") }}
                            </div>
                        </div>

                        <!-- Ø§Ù„ØªÙˆØµÙŠÙ„ -->
                        <div id="matchingFields" class="question-fields" style="display: none;">
                            <h6 class="text-primary mb-3">ğŸ”— Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</h6>
                            <div class="mb-3">
                                {{ form.left_items.label(class="form-label") }}
                                {{ form.left_items(class="form-control", rows="3", placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙŠØ³Ø±Ù‰...\nÙ…Ø«Ø§Ù„:\nØ§Ù„Ø¹Ø§ØµÙ…Ø©\nØ§Ù„Ø¹Ù…Ù„Ø©\nØ§Ù„Ù„ØºØ©") }}
                                <small class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„ Ø¹Ù†ØµØ± ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</small>
                            </div>
                            <div class="mb-3">
                                {{ form.right_items.label(class="form-label") }}
                                {{ form.right_items(class="form-control", rows="3", placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙŠÙ…Ù†Ù‰...\nÙ…Ø«Ø§Ù„:\nØ§Ù„Ø±ÙŠØ§Ø¶\nØ§Ù„Ø±ÙŠØ§Ù„\nØ§Ù„Ø¹Ø±Ø¨ÙŠØ©") }}
                                <small class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„ Ø¹Ù†ØµØ± ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</small>
                            </div>
                            <div class="mb-3">
                                {{ form.correct_matches.label(class="form-label") }}
                                {{ form.correct_matches(class="form-control", rows="3", placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©...\nÙ…Ø«Ø§Ù„:\n0-0\n1-1\n2-2") }}
                                <small class="text-muted">Ø§ÙƒØªØ¨ ÙƒÙ„ ØªÙˆØµÙŠÙ„ ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø´ÙƒÙ„: Ø±Ù‚Ù…_ÙŠØ³Ø§Ø±ÙŠ-Ø±Ù‚Ù…_ÙŠÙ…ÙŠÙ†ÙŠ</small>
                            </div>
                        </div>

                        <!-- Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
                        <div class="mb-3">
                            {{ form.explanation.label(class="form-label") }}
                            {{ form.explanation(class="form-control", rows="2", placeholder="Ø´Ø±Ø­ Ù…ÙØµÙ„ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©)...") }}
                        </div>

                        <div class="d-grid">
                            {{ form.submit(class="btn btn-success") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
        <div class="col-lg-7">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list"></i> Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        <span class="badge bg-light text-dark ms-2">{{ questions|length }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    {% if questions %}
                    <div class="list-group">
                        {% for question in questions %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <!-- Ø±Ø£Ø³ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">
                                            <span class="badge bg-primary me-2">Ø³ {{ loop.index }}</span>
                                            {{ question.question }}
                                        </h6>
                                        <div>
                                            <span class="badge bg-info me-1">{{ question.points }} Ù†Ù‚Ø·Ø©</span>
                                            <span class="badge bg-secondary">
                                                {% if question.type == 'multiple_choice' %}ğŸ§© Ù…ØªØ¹Ø¯Ø¯
                                                {% elif question.type == 'true_false' %}âœ… ØµØ­/Ø®Ø·Ø£
                                                {% elif question.type == 'fill_blank' %}ğŸ“ Ù…Ù„Ø¡ ÙØ±Ø§Øº
                                                {% elif question.type == 'matching' %}ğŸ”— ØªÙˆØµÙŠÙ„
                                                {% else %}â“ Ø¢Ø®Ø±{% endif %}
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ -->
                                    {% if question.type == 'multiple_choice' %}
                                    <div class="mt-2">
                                        {% for option in question.options %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" 
                                                   {% if loop.index0 == question.correct_answer %}checked{% endif %} disabled>
                                            <label class="form-check-label {% if loop.index0 == question.correct_answer %}text-success fw-bold{% endif %}">
                                                {{ option }}
                                            </label>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    
                                    {% elif question.type == 'true_false' %}
                                    <div class="mt-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" 
                                                   {% if question.correct_answer %}checked{% endif %} disabled>
                                            <label class="form-check-label {% if question.correct_answer %}text-success fw-bold{% endif %}">
                                                ØµØ­
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" 
                                                   {% if not question.correct_answer %}checked{% endif %} disabled>
                                            <label class="form-check-label {% if not question.correct_answer %}text-success fw-bold{% endif %}">
                                                Ø®Ø·Ø£
                                            </label>
                                        </div>
                                    </div>
                                    
                                    {% elif question.type == 'fill_blank' %}
                                    <div class="mt-2">
                                        <div class="alert alert-info">
                                            <strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</strong> {{ question.correct_answer }}
                                            {% if question.hint %}
                                            <br><strong>ØªÙ„Ù…ÙŠØ­:</strong> {{ question.hint }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    {% elif question.type == 'matching' %}
                                    <div class="mt-2">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <strong>Ø§Ù„ÙŠØ³Ø§Ø±:</strong>
                                                <ul class="list-unstyled">
                                                    {% for item in question.left_items %}
                                                    <li>{{ loop.index0 }}. {{ item }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Ø§Ù„ÙŠÙ…ÙŠÙ†:</strong>
                                                <ul class="list-unstyled">
                                                    {% for item in question.right_items %}
                                                    <li>{{ loop.index0 }}. {{ item }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}

                                    <!-- Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
                                    {% if question.explanation %}
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <strong>Ø´Ø±Ø­:</strong> {{ question.explanation }}
                                        </small>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="btn-group btn-group-sm ms-3">
                                    <a href="{{ url_for('teacher.teacher_delete_question', test_id=test.id, question_id=question.id) }}" 
                                       class="btn btn-outline-danger btn-sm" 
                                       onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-question-circle fa-2x text-muted mb-3"></i>
                        <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯</p>
                        <p class="text-muted small">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø³Ø¤Ø§Ù„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„
document.getElementById('questionType').addEventListener('change', function() {
    const type = this.value;
    
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
    document.querySelectorAll('.question-fields').forEach(field => {
        field.style.display = 'none';
    });
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
    if (type === 'multiple_choice') {
        document.getElementById('multipleChoiceFields').style.display = 'block';
    } else if (type === 'true_false') {
        document.getElementById('trueFalseFields').style.display = 'block';
    } else if (type === 'fill_blank') {
        document.getElementById('fillBlankFields').style.display = 'block';
    } else if (type === 'matching') {
        document.getElementById('matchingFields').style.display = 'block';
    }
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('questionType').dispatchEvent(new Event('change'));
});
</script>

<style>
.question-fields {
    border-right: 3px solid #0d6efd;
    padding-right: 15px;
    margin-bottom: 20px;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}
</style>
{% endblock %}